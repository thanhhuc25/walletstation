<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Wallet station</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles/app.css" />
    <script src="http://localhost:35729/livereload.js"></script>

    <script src="js/JsBarcode.code128.min.js"></script>
    <script src="js/qrcode.min.js"></script>

</head>
<body>
    <div class="input_page qr-code-page">
        <header class="header">
            <div class="header__back header__back--left">
                <a class="header__back__a" href="input.html">
                    <img src="styles/images/back_ico.png">
                    お支払いコード
                </a>
            </div>
            <div class="header__back--right">
                <img src="styles/images/photo.png">
            </div>
            

        </header>
        <main class="main">
            <div class="input_page__center_text">
                このコードをレジで提示してください
            </div>
            <div class="qr-code-page__content">
                <a id="qr-code" href="javascript:void(0)" class="qr-code-page__content__barcode">
                    <div id="barcode128">
                        <!--<img src="styles/images/barcode.png">-->
                        <svg id="barcode-image"></svg>
                    </div>

                    <!--<div class="qr-code-page__content__barcode__text">-->
                        <!--1234 5678 901234-->
                    <!--</div>-->
                    <div >
                        <!--<img src="styles/images/qrcode.png">-->
                        <div id="qrcode" style="width:128px; height:128px;"></div>
                    </div>
                    <div class="qr-code-page__content__barcode__bottom">
                        <span>
                            <img src="styles/images/circle.png">
                        </span>
                        <span>1:10</span>
                    </div>
                </a>
                <div class="qr-code-page__content__bottom">
                    <div class="qr-code-page__content__bottom__left">
                        <span>
                            <img src="styles/images/p.png">
                        </span>
                        <span>1,000pt</span>
                    </div>
                    <div class="qr-code-page__content__bottom__right">
                        <a href="/index.html">
                            使用しない
                        </a>
                    </div>
                </div>

            </div>
        </main>
    </div>
    <!-- modal-->
    <div id="modal-success" class="modal modal-success">
        <div class="modal-content">
            <div class="modal-content__top">
                <span>
                    <img src="styles/images/wallet2.png">
                </span>
                <span class="modal-content__top__text">
                    お支払い完了
                </span>
            </div>
            <div class="modal-content__text1">
                大楠亭
            </div>
            <div class="modal-content__text2">
                2018/08/20 (金)　12:30
            </div>
            <div class="modal-content__text3">
                ¥5,000
            </div>
            <div class="modal-content__bottom">
                <a href="/index.html">OK</a>
            </div>
        </div>

    </div>
<script>

</script>
<script>
    document.getElementById("qr-code").onclick = function () {
        document.getElementById("modal-success").style.display = "block";
    };
    function generateQRBarCode() {
        fetch("/method_list.php", {
        }).then(function (value) {
            return value.json();
        })
        .then(function (value) {
            if(value.prepaids && value.prepaids.length > 0){
                var method = value.prepaids[0];
                var method_id = method.payment_method_id;

                fetch("/create_token.php", {
                    method: "POST",
                    body: JSON.stringify({payment_method_id: method_id})
                }).then(function (data) {
                    return data.json();
                })
                .then(function (data) {
                    if(data.transaction_token){
                        var transaction_token = data.transaction_token;
                        JsBarcode("#barcode-image",transaction_token, {
                        });
                        // var qrcode = new QRCode(document.getElementById("qrcode"), {
                        //     width : 100,
                        //     height : 100,
                        //     useSVG: true
                        // });
                        // qrcode.makeCode(transaction_token);
                        var qrcode = new QRCode("qrcode", {
                            text: transaction_token,
                            width: 128,
                            height: 128,
                            colorDark : "#000000",
                            colorLight : "#ffffff",
                            correctLevel : QRCode.CorrectLevel.H
                        });
                    }
                })
                .catch(function(err){
                    alert((err));
                })
            }
        })
        .catch(function(err){
            alert((err));
        });
    }
    generateQRBarCode();
</script>
</body>
</html>